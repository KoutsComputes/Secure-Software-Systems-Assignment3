{% extends 'base.html' %}
{% block content %}
  <section class="card">
    <h1>Encryption Diagnostics</h1>
    <p>This page proves ballots are encrypted at rest using AES-GCM.</p>
  </section>

  <section class="grid-2">
    <div class="card">
      <h2>Sample Encryption Round-Trip</h2>
      <p><strong>Plaintext example</strong>: {{ sample_plain }}</p>
      <p><strong>Encrypted output</strong>:</p>
      <pre>{{ sample_cipher }}</pre>
      <p>
        Each refresh generates a different ciphertext because AES-GCM includes a random nonce,
        but the plaintext still decrypts correctly server-side.
      </p>
    </div>

    <div class="card">
      <h2>Latest Stored Ballot</h2>
      {% if latest_vote_id %}
        <p><strong>Vote ID</strong>: {{ latest_vote_id }}</p>
        <p><strong>Database value</strong> (ciphertext):</p>
        <pre>{{ stored_cipher }}</pre>
        <p><strong>Server-side decrypted view</strong> (for testing only):</p>
        <pre>{{ stored_plain or 'Could not decrypt (ciphertext missing or tampered)' }}</pre>
        <p>
          The ciphertext looks random, verifying confidentiality in storage. Decryption happens only in memory
          when tallying or running this diagnostics page.
        </p>
      {% else %}
        <p>No votes recorded yet. Cast one through the voting form to populate this section.</p>
      {% endif %}
    </div>
  </section>

  <section class="card">
    <h2>Disclaimer</h2>
    <p>For voter confidentiality testing only. Do not expose plaintext results outside controlled evaluation sessions.</p>
  </section>
{% endblock %}
