<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or 'Electronic Voting Prototype' }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">Electronic Voting Prototype</div>
      <nav class="nav">
        <a href="{{ url_for('index') }}">Home</a>
        {% if user_role == 'admin' %}
        <!-- Gurveen - Issue #2: expose integrity diagnostics to admin -->
        <a href="{{ url_for('integrity_test') }}">Integrity Tests</a>
        <!-- Gurveen - Issue #3: provide rate limit verification harness -->
        <a href="{{ url_for('rate_limit_test') }}">Rate Limiter Test</a>
        {% endif %}

        {% if session.get('user_id') %}
          {# Theo: Issue 7 - Show menu based on role #}
          {% if user_role in ['clerk','admin'] %}
          <div class="nav-group">
            <span>Voters</span>
            <div class="nav-menu">
              <a href="{{ url_for('check_enrolment') }}">Check Enrolment</a>
              <a href="{{ url_for('voters') }}">View Voters</a>
            </div>
          </div>
          {% endif %}

          {% if user_role == 'admin' %}
          <div class="nav-group">
            <span>Candidates</span>
            <div class="nav-menu">
              <a href="{{ url_for('add_candidate') }}">Add Candidate</a>
              <a href="{{ url_for('candidates') }}">View Candidates</a>
            </div>
          </div>
          {% endif %}

          <div class="nav-group">
            <span>Voting</span>
            <div class="nav-menu">
              <a href="{{ url_for('secure_vote') }}">Vote (MFA)</a>
              <a href="{{ url_for('vote_overseas') }}">Vote (Overseas)</a>
            </div>
          </div>

          <div class="nav-group">
            <span>Results</span>
            <div class="nav-menu">
              <a href="{{ url_for('results') }}">Results</a>
              {% if user_role in ['clerk','admin'] %}
                <a href="{{ url_for('recount') }}">Recount</a>
              {% endif %}
              {% if user_role == 'admin' %}
                <a href="{{ url_for('import_scanned') }}">Import Scanned</a>
              {% endif %}
            </div>
          </div>

          <!-- Theo: Issue 6/7 - Account links (Login/Register or Dashboard/Logout) -->
          <div class="nav-group">
            <span>Account</span>
            <div class="nav-menu">
              <a href="{{ url_for('dashboard_root') }}">Dashboard</a>
              <a href="{{ url_for('auth_mfa_setup') }}">MFA Setup</a>
              <a href="{{ url_for('auth_logout') }}">Logout</a>
            </div>
          </div>
        {% else %}
          <!-- Logged out: Only show account actions -->
          <div class="nav-group">
            <span>Account</span>
            <div class="nav-menu">
              <a href="{{ url_for('auth_login') }}">Login</a>
              <a href="{{ url_for('auth_register') }}">Register</a>
            </div>
          </div>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash">
          {% for m in messages %}<div class="flash-item">{{ m }}</div>{% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer">
    <div class="container">&copy; Prototype</div>
  </footer>
</body>
</html>
