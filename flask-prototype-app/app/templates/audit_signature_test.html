{% extends 'base.html' %}
{% block content %}
  <section class="card wide">
    <h1>Digital Signature Verification</h1>
    <p class="notice warning">
      <strong>Testing Only:</strong> This digital signature validation dashboard is intended for administrator verification in non-production environments. <!-- Gurveen - Issue #4: remind admins the feature is a diagnostic aid, not a public-facing workflow. -->
    </p>
    <article class="status">
      <h2>Hash Chain Integrity</h2>
      <p class="{{ 'status-ok' if chain_ok else 'status-fail' }}">
        {% if chain_ok %}
          PASS Audit log hash chain verified successfully.
        {% else %}
          FAIL Audit log verification failed. Review the server logs and regenerate signatures.
        {% endif %}
      </p>
    </article>

    {% if log_error %}
      <div class="alert alert-error">
        {{ log_error }}
      </div>
    {% elif entries %}
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>Timestamp (UTC)</th>
              <th>Actor</th>
              <th>Action</th>
              <th>Signature Status</th>
              <th>Signature Algorithm</th>
              <th>Signature (truncated)</th>
              <th>Public Key (truncated)</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in entries %}
              <tr class="{{ 'pass' if entry.signature_valid else 'fail' }}">
                <td>{{ entry.timestamp }}</td>
                <td>{{ entry.actor }}</td>
                <td>{{ entry.action }}</td>
                <td>
                  {% if entry.signature_valid %}
                    PASS Valid
                  {% else %}
                    FAIL {{ entry.sig_issue or 'Unknown issue' }}
                  {% endif %}
                </td>
                <td>{{ entry.signature_alg or 'n/a' }}</td>
                <td>
                  {% if entry.signature %}
                    {{ entry.signature[:16] }}...
                  {% else %}
                    n/a
                  {% endif %}
                </td>
                <td>
                  {% if entry.public_key %}
                    {{ entry.public_key[:16] }}...
                  {% else %}
                    n/a
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p>No audit entries have been recorded yet. Trigger actions (e.g., login, vote submission) to populate the log.</p>
    {% endif %}

    <p class="fine-print">
      <!-- Gurveen - Issue #4: clarify that this surface is read-only and meant to help auditors evaluate signature coverage. -->
      The table lists the 25 most recent audit entries, including their digital signature verification status. Use server-side tooling to export the full log for formal auditing procedures.
    </p>
  </section>
{% endblock %}
