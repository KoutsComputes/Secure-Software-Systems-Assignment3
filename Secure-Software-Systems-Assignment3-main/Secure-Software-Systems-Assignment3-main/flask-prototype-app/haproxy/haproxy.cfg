global
    log stdout format raw daemon

defaults
    log     global
    mode    http
    option  httplog
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend voting_frontend
    bind *:5000
    option http-server-close
    default_backend flask_backends

backend flask_backends
    balance roundrobin
    option httpchk GET /healthz
    http-check expect status 200
    # Gurveen - Issue #3: Two Flask replicas mean HAProxy can fail over seamlessly.
    server app_primary app_primary:5000 check inter 5s fall 3 rise 2
    server app_secondary app_secondary:5000 check inter 5s fall 3 rise 2
